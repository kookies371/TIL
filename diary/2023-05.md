# 2023-05-02

## 잡담

주말 + 여행으로 약 10일간 휴가 보내고 옴.

휴가 직전에 시각화 자료를 임시로 만들어서 보낼 일이 있었는데, 시각화 코드 일부를 수정해서 급하게 만들어서 보냈다. 그런데 오늘 와서 보니,,, 이걸 다시 원상복구 시키는 것이 쉽지 않다. 저번에 임시 수정할 때 branch 파서 수정하고, 지금은 그냥 branch만 원복하면 되는 것을... 아직 git에 익숙하지 않다보니 이런 기초적인 활용법도 제대로 쓰지 못했다. ㅠㅠ

hotfix는 아니지만, 암튼 임시로 코드를 수정할 일이 있을 때조차도 git을 사용하는 것은 매우 강력하다는 것을 깨달은 계기.

## svg 파일

폰트 자동으로 다운로드 및 PIL 적용 코드를 찾다가 [네이버 공식 github](https://github.com/naver/nanumfont/blob/master/README.md)을 찾았다. README.md에 svg 로고가 있길래, 전에 살짝 공부했던 거 한 번 정리해봤다.

# 2023-05-03

## 잡담

오늘은 공부는 거의 못했다. 대학교 같은 과 형이 Rust에 푹 빠져있었던 기억이 나서 좀 검색하다보니, Unreal-Rust가 소개되었다는 소식과 같은,, 매우 흥미로운 소식을 봤다. [링크](https://careerly.co.kr/comments/68058)

항상 말로만 Rust 공부하겠다 했었고, 최근에는 언리얼을 공부하는 게 어떨까라고 진지하게 생각 중이었는데, 진짜로 공부를 시작할 좋은 기회인 듯.

# 2023-05-08

## Rust 입문

주말에 Rust 입문을 조금 공부했다. 

변수 및 container type, 함수 선언, 분기문 등등은 여타 프로그래밍 언어와 같아서 어렵지 않았다. 

역시나 문제는 **소유권**부터였는데, C++과 Python 정도만 공부해본 입장에서는 꽤 난해했다. string type의 변수를 함수에 넘기면 소유권이 바뀌며 bind가 해제된다...? 

그래도 bind가 해제되는 변수와 해제되지 않는 변수의 기준은 Python과 비슷한 것 같아 조금 나았지만, 이걸 실제 프로그래밍에서 오류 없이 사용할 수 있을 거라는 자신감은 없다. 심지어 Rust 입문 서적 4장의 마지막에 나온 예시에서 &str type을 사용하여 String과 str을 동시에 호환시킬 수 있다는 것까지 보니 type error도 체크하기 어려운데 이런 호환성까지 신경쓸 수 있으려면 확실히 공부를 많이 해야겠더라.

난해하긴 했지만, 아직 입문 수준이라 그런지 개념 자체를 이해하는 것은 어렵지 않았다. 직접 코드를 작성했을 때 미친듯이 버그 날 게 뻔하지만, 일단 첫 걸음은 만족.

# 2023-05-12

## 잡담

며칠 일이 급해서 개인 공부를 거의 못했다.

어제 오늘 잠시 여유가 생겨 기존 코드를 천천히 뜯어보면서 리팩토링할 수 있는 부분은 리팩토링하고 있었는데, 분명 사용되지 않는 코드라 판단하여 몇 부분 지웠더니 코드가 돌아가지 않는다..!

거의 3~4시간동안 도대체 어디를 지운 것이 문제인지 역추적해보니...

발생한 상황

- main.py에서 event.py의 변수 하나를 import 함
- 변수 import 후 아무런 수정이 없는데, event.py에서의 변수값과 main.py에서의 변수값이 다르다는 문제 발생

문제점

- main.py에는 event.py 말고도 main.py -> vis.py -> eventcategory.py 순서대로 import하는 구조가 있었음
- vis.py에서 eventcategory.py의 변수를 import하고 있었는데, 이는 코드 작성 초기에 eventcategory의 정보로 시각화 테스트 코드를 짰기 때문. 시간이 흘러 테스트용 코드가 필요없어져 eventcategory에서 가져온 변수들이 사용되지 않아 VS Code에서 흐린 색으로 표현됨.
- 그런데, eventcategory에는 event.py의 변수들의 내부값을 수정하는 코드가 있음. 즉 eventcategory.py를 어딘가에서 import하는 것만으로도 evetn.py의 변수들이 update되는 것.
- 앞서 말했뜨시 vis.py에서 eventcategory.py의 변수들이 사용되지 않으니 의존성이 없다고 판단, import 코드를 삭제함. 그런데 이 삭제로 인해 eventcategory.py를 import하는 부분이 하나도 남지 않아 event.py의 update 코드 역시 사라져버린 것.
- 결국 main.py와 event.py에서는 event와 관련된 변수를 단 한 번도 건드리지 않았는데, 뜬금없이 vis.py에서 의존성이 없다고 생각했던 import 한 줄을 건드린 것이 문제의 원인.
- 근본적인 문제점은 아래 두 가지로 요약할 수 있음.
  - eventcategory.py에서 event.py의 변수를 수정
  - main.py -> vis.py -> eventcategory.py로 이어지는 비직관적인 의존관계

해결책

- 당장은 일이 급하니 이 말도 안 되는 의존관계를 유지할 예정
- 천천히 개선할 시간이 생기면, 의존관계를 수정할 예정
  - data.py라는 데이터 로드를 담당하는 파일이 있는데, 이 파일에 event 정보 로딩 및 category 속성 부여도 포함시키기
  - event.py와 eventcategory.py에서 데이터 로드하는 부분 삭제
  - vis.py와 eventcategory.py 의존성 삭제

배운점
- 의존성 파악이 매우매우 중요함을 느꼈다. 의존성 설계를 트리구조로 해야 파악이 훨씬 쉬울 것 같고, 또 이 의존성 설계를 어기는 import는 test용으로도 있으면 안 된다.
- 테스트하고 싶으면 tests directory에서 하던가 if name == "main":  걸어놓고 여기서 import 하자. 그러면 나중에 지울 때도 안 헷갈릴 듯.
- 소유권...? 이라는 단어가 정확한 표현은 아닌 것 같지만 변수의 소유관계를 명확하게 설정해야 한다. eventcategory.py가 event.py의 변수를 수정한 것도 이 상황의 "근본적인 문제점" 중 하나라고 생각하는데, 어떤 파일에서 어떤 변수값을 수정할 지 예상할 수 없게 만들기 때문. (이게 함수형 프로그래밍의... 이유랑 연결되는 건가?)

# 2023-05-15

## 잡담 (git)

대부분 코딩을 혼자 들이박으면서 배우고 있다보니, 별 거 아닌 것 같은 기능에 신세계를 볼 때가 많다.

[5월 2일](#2023-05-02)에 git branch만 원복하면 될 일을 좀 번거롭게 했다... 라는 일기를 적은 적이 있는데 저번주~오늘 잘 써먹고 있다. [5월 12일](#2023-05-12)에 적어놓은 리팩토링 관련해서 이것저것 고치는 중인데, 브랜치를 파놓고 작업하니 이렇게 편할 수가 없다. main branch를 건드리지 않으니 치명적인 오류가 발생할 일이 없다니!!

단 branch를 파서 main은 걱정이 없어도 commit은 commit. 매 commit마다 신경써야될 부분은 여전히 꼼꼼하게 신경써주는 습관을 들이고 있다. 가령 commit 직전에 내가 의도한 대로 코드가 모두 잘 돌아가는지는 꼭 확인해본다.

예전에 pytest 좀 공부하긴 했는데, 아직 익숙한 단계는 전혀 아니다. 바로 윗줄에서 말한 "커밋 전에는 항상 체크하기"도 test 코드가 짜는 법에 익숙해져야 완전히 습관으로 정착될 수 있을 듯.

TODO

- branch에는 이제 쪼끔 익숙해진 것 같다. 계속 잘 지지고 볶고 해보자.
- test 코드 짜는 법도 계속 공부하자. commit 직전에는 항상 test 돌리기!
- (만약 프로젝트가 커져서 매번 test하는 게 번거롭거나, live service에서는 어떻게 해야 하는지는... 아직 모른다 ㅠ. 친구한테 물어봐야징)

# 2023-05-17

## `pd.Series.to_list()` vs `pd.Series.tolist()`

pandas 지지고 볶다 보면 VS Code에서 자동완성으로 `to_list()`와 `tolist()`를 항상 같이 보여준다. 도대체 이 두 놈이 뭔 차이인지 자주 궁금하다가 오늘에서야 찾아봤는데 쪼끔 재밌어서 기록해본다.

여억시 [stackoverflow](https://stackoverflow.com/questions/57854228/pandas-dataframe-index-to-list-vs-tolist)에 답이 있다. [source-code](https://github.com/pandas-dev/pandas/blob/v0.25.1/pandas/core/base.py#L1183)에서 `to_list`는 `tolist`의 alias로 추가되었고, 심지어 `tolist`는 semi-deprecated라는 말까지...

pandas같은 거대한 프로젝트에서도 이런 자잘한 실수(?)가 있다는 건 항상 새삼스러운 재미를 준다.

# 2023-05-25

## 잡담 1

문장 생성 task가 잠시 소강상태에 들어가서 오랜만에 크롤링 코드를 다시 들여다봤다. 겸사겸사 pytest도 적극적으로 다시 봤다.

[과거 일기](https://github.com/kookies371/TIL/blob/main/diary/2023-04.md#%ED%8C%8C%EC%9D%B4%EC%8D%AC-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EA%B5%AC%EC%A1%B0)
를 다시 뜯어보며, MS qlib을 좀 더 꼼꼼히 봤다.

디렉토리 구조부터 다시 배운 것이 많다. 대충 정리하면 아래와 같다.

- src, tests 모두 아래에 `__init__.py`를 넣자. 그리고 모든 import 는 모듈을 import한다는 마음으로, `from src.module import function` 형식으로 쓰자.
- scripts 디렉토리의 존재를 알았다. 원래는 `src/main.py` 만들어놓고 얘를 실행하는 방식을 썼는데, 이게 훨씬 나은 것 같다. 실행용 코드를 따로 두자.
- src든 tests든 세부 디렉토리를 더 나누는 것도 좋아 보인다. 가령 네이버를 크롤링한다고 해도, 내부적으로 뉴스 크롤링, 블로그 크롤링 등이 필요하다면 파일을 나눠버리자. 각 task에 필요한 utils나 Cralwer 구조도 다를 것이기 때문에
- 간단한 디버깅들도 pytest로 하자. 파이썬 기본 에러툴도 function call stack과 error message는 보여주지만, 그게 다라서 직접 print 찍어보면서 에러 원인을 찾아야 한다. pytest는 파이썬 기본 에러 툴보다 훨씬 제공해주는 정보가 많아 디버깅이 오히려 좋다.
- (qlib은 `setuptools`라는 걸 썼던데, 나한텐 아직 불필요한 것 같아 생략)

후... 얼마나 잘못된 습관을 가지고 코딩하고 있었는 지...

## 잡담 2

그리고,, 오늘 아래 조건을 만족하는 함수를 짜다가 꽤 큰 깨달음을 얻었다.

함수 spec
- 단어들(words: list[str])을 입력받는다. 갯수는 제한이 없다.
- 단어들과 관련된 정보를 받아오도록 api call 넣는다. 단, 이 때 한 call당 수용가능한 최대 단어의 수는 5개다.
- 그래서 words를 받으면, 걔를 5개씩 쪼개고, 각각 call을 넣어 list[response]를 받았다. 그리고 이 list[response]를 그냥 return했다.

짜놓고, 다른 곳에서 사용하려다 보니 자꾸 코드가 꼬이는 느낌이 들었다. 실제로 코드도 잘 안 짜지고.

한참 생각해보다가 느낀 근본적인 문제점이 느껴졌다. 애초에 어떤 함수를 만들 때, **입력과 출력의 위계가 맞아야 한다**는 것.

좀 더 일반론적인 표현으로 말하자면, 입력값에 따라 출력값도 기대하는 포맷이 생길 수밖에 없는데, 기존의 함수는 이 포맷에 있어서 불일치가 있던 것이다.

입력하는 words들이 word들의 1차원 나열인데, 나오는 결과값인 responses는 사실 5개씩 묶은 word들에 대한 response의 list였기 때문에, 사실상 2차원 나열이었던 것.

결국 이 2차원 응답을 다시 1차원으로 풀어주는 것 역시 **이 함수의 역할**이었어야 하는 것이다.

그걸 생각 안 하고 대충 responses를 출력하게 만들어놓고, 이걸 main급 함수에서 처리하려고 하니 main 함수가 지나치게 비대해지고 복잡해진 것이다.

항상 함수를 찢을 때는, 그 **함수의 역할**과 입력/출력에 대한 포맷을 고민해야 한다..를 다시 느꼈다.

# 2023-05-30

## 잡담 (GitLens)

최근에 회사 컴퓨터가 바뀌었는데, 분명 바뀌기 전에는 "ctrl + shift + G ,"가 compare changes를 보여주는 단축키였다.

근데 지금은 안 되길래,,, 킹갓 챗지피티에게 물어보니, 문제해결이 아니라 "git changes를 보고 싶다면 GitLens를 깔아보세요!"라고 말하더라.

아니 난 단축키가 왜 안 되냐고 물어봤는데 뜬금없이 extension을 추천해주길래 얘 또 헛소리하네... 했는데

GitLens 기본 기능에 위에서 궁금했던 단축키 추가가 있었나보다. GitLens 까니까 된다.

너무 예전부터 깔아서 GitLens의 기능인지조차 모르고 썼던 것 같다.

## 잡담 (pylint)

qlib을 좀 더 보니, 중간에 "# pylint: disable=C0415" 라는 주석이 왕창 추가되는 git history가 있었다.

이게 뭘까... 보다가 이번에도 킹갓 챗지피티에 물어보니 주석도 pylint warning을 무시하게 만드는 것과 같은 "기능"을 할 수 있고,

이런 걸 "지시문 주석(directive comments)" 혹은 "특수 주석(special comments)"라고 한다.

C0415는 import in function, W0611은 unused import와 같은 규칙들이 있다. 

지금 당장 필요성은 없지만 알면 좋을 듯!